<!DOCTYPE html>
<html>
<head>
    <title>Woj | 信息竞赛平台</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js"></script>
    <style>
        /* 保持原有样式不变，只添加删除按钮样式 */
        .problem-actions {
            display: flex;
            gap: 10px;
        }
        .delete-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 2px 8px;
            border-radius: 4px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- 侧边栏 -->
    <div id="sidebar" style="width: 180px;">
        <h2>Woj导航</h2>
        <button onclick="location.hash=''">🏠 主页</button>
        <button onclick="location.hash='#problem'">📚 题库</button>
        <button onclick="location.href='newproblem.html'" style="margin-top: 20px;">✚ 新建题目</button>
    </div>

    <!-- 主内容区 -->
    <div id="main-content">
        <!-- 主页内容 -->
        <div id="home-page">
            <div class="header">
                <h1>Woj | 信息竞赛平台</h1>
                <p>练习编程，提升算法能力</p>
            </div>
            
            <!-- 题目详情容器 -->
            <div id="problem-container" class="problem-container" style="display: none;">
                <h2 class="problem-title" id="current-problem-title"></h2>
                <div class="problem-content" id="current-problem-content"></div>
            </div>

            <!-- 代码编辑器容器 -->
            <div id="editor-container">
                <div id="editor"></div>
            </div>

            <!-- 运行控制区 -->
            <div id="run-controls">
                <!-- 保持原有运行控制区不变 -->
            </div>

            <!-- 输入输出区 -->
            <div id="io-container">
                <!-- 保持原有输入输出区不变 -->
            </div>
        </div>

        <!-- 题库内容 -->
        <div id="problem-list" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h2>📚 题库列表</h2>
                <button onclick="location.href='newproblem.html'">✚ 新建题目</button>
            </div>
            <div id="problems-container"></div>
        </div>
    </div>

    <script>
        // 初始化代码编辑器
        const editor = ace.edit("editor");
        editor.setTheme("ace/theme/chrome");
        editor.session.setMode("ace/mode/c_cpp");
        editor.setOptions({
            fontSize: "14px",
            showLineNumbers: true,
            showGutter: true,
            highlightActiveLine: true
        });
        editor.setValue("", -1);

        // 从localStorage加载题目或初始化空题库
        let problems = JSON.parse(localStorage.getItem('woj_problems')) || {};

        // 渲染题库列表
        function renderProblemList() {
            const container = document.getElementById('problems-container');
            container.innerHTML = '';
            
            Object.keys(problems).sort().forEach(id => {
                const problem = problems[id];
                const item = document.createElement('div');
                item.className = 'problem-item';
                item.innerHTML = `
                    <div style="flex: 1; cursor: pointer;" onclick="loadProblem('${id}')">
                        <span class="problem-id">${id}</span>
                        <span class="problem-name">${problem.title.split('|')[1]?.trim() || problem.title}</span>
                    </div>
                    <div class="problem-actions">
                        <button class="delete-btn" onclick="deleteProblem('${id}', event)">删除</button>
                    </div>
                `;
                container.appendChild(item);
            });
            
            if (Object.keys(problems).length === 0) {
                container.innerHTML = '<p>题库为空，点击"新建题目"添加题目</p>';
            }
        }

        // 加载题目
        function loadProblem(id) {
            location.hash = `problem/${id}`;
            const problem = problems[id];
            if (!problem) return;
            
            document.getElementById("problem-container").style.display = "block";
            document.getElementById("current-problem-title").textContent = problem.title;
            document.getElementById("current-problem-content").innerHTML = problem.description;
            document.getElementById("home-page").style.display = "block";
            document.getElementById("problem-list").style.display = "none";
            
            editor.setValue(problem.template || "", -1);
            document.getElementById("stdin").value = "";
            document.getElementById("result").innerHTML = "请先编写代码并点击运行";
        }

        // 删除题目
        function deleteProblem(id, event) {
            event.stopPropagation();
            if (confirm(`确定要删除题目 ${id} 吗？`)) {
                delete problems[id];
                localStorage.setItem('woj_problems', JSON.stringify(problems));
                renderProblemList();
                if (location.hash.includes(id)) {
                    location.hash = '#problem';
                }
            }
        }

        // 路由控制
        function handleRoute() {
            const hash = location.hash;
            
            if (hash.startsWith('#problem/')) {
                const id = hash.split('/')[1];
                loadProblem(id);
            } else if (hash === '#problem') {
                document.getElementById("home-page").style.display = "none";
                document.getElementById("problem-list").style.display = "block";
                document.getElementById("problem-container").style.display = "none";
                renderProblemList();
            } else {
                document.getElementById("home-page").style.display = "block";
                document.getElementById("problem-list").style.display = "none";
                document.getElementById("problem-container").style.display = "none";
            }
        }

        // 初始化
        window.addEventListener('load', handleRoute);
        window.addEventListener('hashchange', handleRoute);
    </script>
</body>
</html>
