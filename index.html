<!DOCTYPE html>
<html>
<head>
    <title>Woj | ä¿¡æ¯ç«èµ›å¹³å°</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js"></script>
    <style>
        /* ä¿æŒåŸæœ‰æ ·å¼ä¸å˜ï¼Œåªæ·»åŠ åˆ é™¤æŒ‰é’®æ ·å¼ */
        .problem-actions {
            display: flex;
            gap: 10px;
        }
        .delete-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 2px 8px;
            border-radius: 4px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- ä¾§è¾¹æ  -->
    <div id="sidebar" style="width: 180px;">
        <h2>Wojå¯¼èˆª</h2>
        <button onclick="location.hash=''">ğŸ  ä¸»é¡µ</button>
        <button onclick="location.hash='#problem'">ğŸ“š é¢˜åº“</button>
        <button onclick="location.href='newproblem.html'" style="margin-top: 20px;">âœš æ–°å»ºé¢˜ç›®</button>
    </div>

    <!-- ä¸»å†…å®¹åŒº -->
    <div id="main-content">
        <!-- ä¸»é¡µå†…å®¹ -->
        <div id="home-page">
            <div class="header">
                <h1>Woj | ä¿¡æ¯ç«èµ›å¹³å°</h1>
                <p>ç»ƒä¹ ç¼–ç¨‹ï¼Œæå‡ç®—æ³•èƒ½åŠ›</p>
            </div>
            
            <!-- é¢˜ç›®è¯¦æƒ…å®¹å™¨ -->
            <div id="problem-container" class="problem-container" style="display: none;">
                <h2 class="problem-title" id="current-problem-title"></h2>
                <div class="problem-content" id="current-problem-content"></div>
            </div>

            <!-- ä»£ç ç¼–è¾‘å™¨å®¹å™¨ -->
            <div id="editor-container">
                <div id="editor"></div>
            </div>

            <!-- è¿è¡Œæ§åˆ¶åŒº -->
            <div id="run-controls">
                <!-- ä¿æŒåŸæœ‰è¿è¡Œæ§åˆ¶åŒºä¸å˜ -->
            </div>

            <!-- è¾“å…¥è¾“å‡ºåŒº -->
            <div id="io-container">
                <!-- ä¿æŒåŸæœ‰è¾“å…¥è¾“å‡ºåŒºä¸å˜ -->
            </div>
        </div>

        <!-- é¢˜åº“å†…å®¹ -->
        <div id="problem-list" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h2>ğŸ“š é¢˜åº“åˆ—è¡¨</h2>
                <button onclick="location.href='newproblem.html'">âœš æ–°å»ºé¢˜ç›®</button>
            </div>
            <div id="problems-container"></div>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–ä»£ç ç¼–è¾‘å™¨
        const editor = ace.edit("editor");
        editor.setTheme("ace/theme/chrome");
        editor.session.setMode("ace/mode/c_cpp");
        editor.setOptions({
            fontSize: "14px",
            showLineNumbers: true,
            showGutter: true,
            highlightActiveLine: true
        });
        editor.setValue("", -1);

        // ä»localStorageåŠ è½½é¢˜ç›®æˆ–åˆå§‹åŒ–ç©ºé¢˜åº“
        let problems = JSON.parse(localStorage.getItem('woj_problems')) || {};

        // æ¸²æŸ“é¢˜åº“åˆ—è¡¨
        function renderProblemList() {
            const container = document.getElementById('problems-container');
            container.innerHTML = '';
            
            Object.keys(problems).sort().forEach(id => {
                const problem = problems[id];
                const item = document.createElement('div');
                item.className = 'problem-item';
                item.innerHTML = `
                    <div style="flex: 1; cursor: pointer;" onclick="loadProblem('${id}')">
                        <span class="problem-id">${id}</span>
                        <span class="problem-name">${problem.title.split('|')[1]?.trim() || problem.title}</span>
                    </div>
                    <div class="problem-actions">
                        <button class="delete-btn" onclick="deleteProblem('${id}', event)">åˆ é™¤</button>
                    </div>
                `;
                container.appendChild(item);
            });
            
            if (Object.keys(problems).length === 0) {
                container.innerHTML = '<p>é¢˜åº“ä¸ºç©ºï¼Œç‚¹å‡»"æ–°å»ºé¢˜ç›®"æ·»åŠ é¢˜ç›®</p>';
            }
        }

        // åŠ è½½é¢˜ç›®
        function loadProblem(id) {
            location.hash = `problem/${id}`;
            const problem = problems[id];
            if (!problem) return;
            
            document.getElementById("problem-container").style.display = "block";
            document.getElementById("current-problem-title").textContent = problem.title;
            document.getElementById("current-problem-content").innerHTML = problem.description;
            document.getElementById("home-page").style.display = "block";
            document.getElementById("problem-list").style.display = "none";
            
            editor.setValue(problem.template || "", -1);
            document.getElementById("stdin").value = "";
            document.getElementById("result").innerHTML = "è¯·å…ˆç¼–å†™ä»£ç å¹¶ç‚¹å‡»è¿è¡Œ";
        }

        // åˆ é™¤é¢˜ç›®
        function deleteProblem(id, event) {
            event.stopPropagation();
            if (confirm(`ç¡®å®šè¦åˆ é™¤é¢˜ç›® ${id} å—ï¼Ÿ`)) {
                delete problems[id];
                localStorage.setItem('woj_problems', JSON.stringify(problems));
                renderProblemList();
                if (location.hash.includes(id)) {
                    location.hash = '#problem';
                }
            }
        }

        // è·¯ç”±æ§åˆ¶
        function handleRoute() {
            const hash = location.hash;
            
            if (hash.startsWith('#problem/')) {
                const id = hash.split('/')[1];
                loadProblem(id);
            } else if (hash === '#problem') {
                document.getElementById("home-page").style.display = "none";
                document.getElementById("problem-list").style.display = "block";
                document.getElementById("problem-container").style.display = "none";
                renderProblemList();
            } else {
                document.getElementById("home-page").style.display = "block";
                document.getElementById("problem-list").style.display = "none";
                document.getElementById("problem-container").style.display = "none";
            }
        }

        // åˆå§‹åŒ–
        window.addEventListener('load', handleRoute);
        window.addEventListener('hashchange', handleRoute);
    </script>
</body>
</html>
